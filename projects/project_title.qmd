---
title: "Gene Dosage Effects of Chromosome 12 Trisomy in Human Induced Pluripotent Stem Cells (iPSCs)"
author:
  - name: "Fahmida Sultana"
    affiliation: "Department of Cell Biology, OUHSC"
date: 2025-07-28
format:
  html:
    toc: true
    toc-location: right
    toc-depth: 2
    number-sections: false
    theme: default
    css: styles.scss

execute:
  echo: true
  
---
## **Project Overview**

Aneuploidy, the presence of an abnormal number of chromosomes, is a common genomic alteration observed in both developmental disorders and cancer. While most aneuploidies are detrimental to cellular function, some specific chromosomal gains may confer selective growth advantages in certain contexts. Human induced pluripotent stem cells (iPSCs) serve as a powerful model system to study the effects of aneuploidy due to their self-renewal capacity and potential for differentiation.

In this project, we focus on trisomy of chromosome 12 (T12), a frequently observed aneuploidy in cultured iPSCs. This chromosomal gain is particularly intriguing because it has been associated with increased proliferation and stemness, and is often detected in iPSC lines during long-term culture. By investigating transcriptomic data, we aim to explore how the extra copy of chromosome 12 alters gene expressions, and how these molecular changes contribute to altered cellular phenotypes.

Understanding the gene dosage effects of trisomy 12 in iPSCs not only provides insights into the biology of stem cell maintenance and genomic instability but also has implications for regenerative medicine and disease modeling, where genomic integrity is crucial.

## Load Required Libraries

```{r}
# Load tidyverse for wrangling, plotting, and file reading
library(tidyverse)
```
## Load and Preview the RNA-seq Dataset

We load the CSV file using `read_csv()` and use `head()` and `glimpse()` to confirm successful import and examine the structure.
The dataset `BulkRNAseq_with_Chr.csv` contains normalized expression values, fold changes, statistical test results, and chromosome annotations for over 12,000 genes. Below, we load the dataset and preview the first few rows to verify that it has been imported correctly.
```{r}
# Read CSV and preview first few rows
library(readr)

rna <- read_csv("../data/BulkRNAseq_with_Chr.csv")
head(rna)

glimpse(rna)

```

## Summarize Dataset

### A. How many genes are upregulated or downregulated in trisomic iPSCs?

We define significantly upregulated genes as those with log₂ fold change ≥ log₂(1.5) and FDR-adjusted p-value < 0.05. Downregulated genes meet the same p-value threshold and log₂ fold change ≤ -log₂(1.5),comparing trisomic (P33_1, P33_2, P33_3) versus disomic (P3_1, P3_2, P3_3) iPSCs.

```{r}

# Step 1: Define thresholds
log2fc_cutoff <- log2(1.5)
padj_cutoff <- 0.05

# Step 2: Categorize genes
rna <- rna %>%
  mutate(
    Regulation = case_when(
      log2FoldChange >= log2fc_cutoff & pAdj < padj_cutoff ~ "Upregulated",
      log2FoldChange <= -log2fc_cutoff & pAdj < padj_cutoff ~ "Downregulated",
      TRUE ~ "Not Significant"
    )
  )

# Step 3: Filter out NA chromosome names and define correct chromosome order
valid_chromosomes <- c(as.character(1:22), "X", "Y")

# Step 4: Summarize data per chromosome and regulation category
reg_summary <- rna %>%
  filter(Regulation != "Not Significant", chromosome_name %in% valid_chromosomes) %>%
  mutate(chromosome_name = factor(chromosome_name, levels = valid_chromosomes)) %>%
  count(chromosome_name, Regulation) %>%
  complete(chromosome_name, Regulation, fill = list(n = 0))

# Step 5: Plot
ggplot(reg_summary, aes(x = chromosome_name, y = n, fill = Regulation)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(
    title = "Up- and Downregulated Genes in Trisomic vs. Disomic iPSCs by Chromosome",
    x = "Chromosome",
    y = "Number of Genes"
  ) +
  theme_minimal()

```

### B. Is there a clear clustering of iPSCs by karyotype (trisomic vs. disomic) in the principal component space?

```{r}

# Extract expression matrix (only the columns with expression values)
expr_matrix <- rna %>%
  select(P33_1, P33_2, P33_3, P3_1, P3_2, P3_3) %>%
  as.matrix()

# Transpose the matrix: samples as rows, genes as columns
expr_t <- t(expr_matrix)

# Perform PCA
pca_res <- prcomp(expr_t, scale. = TRUE)

# Create a data frame with PCA scores
pca_df <- as.data.frame(pca_res$x)

# Add sample group labels (in same order as columns in original matrix)
pca_df$Group <- c("Trisomic", "Trisomic", "Trisomic", "Disomic", "Disomic", "Disomic")

# Plot PCA
ggplot(pca_df, aes(x = PC1, y = PC2, color = Group)) +
  geom_point(size = 4) +
  labs(
    title = "PCA of Gene Expression: Trisomic vs. Disomic iPSCs",
    x = paste0("PC1 (", round(summary(pca_res)$importance[2, 1] * 100, 1), "%)"),
    y = paste0("PC2 (", round(summary(pca_res)$importance[2, 2] * 100, 1), "%)")
  ) +
  theme_minimal()

# PCA variance summary
pca_var_df <- as.data.frame(summary(pca_res)$importance[1:2, ])
pca_var_df <- tibble::rownames_to_column(pca_var_df, var = "Metric")

# View the table
pca_var_df

# Extract proportion of variance explained
variance_explained <- summary(pca_res)$importance[2, ]  # Second row = proportion of variance
pc_names <- names(variance_explained)

# Create a data frame for plotting
var_df <- data.frame(
  PC = pc_names,
  Variance = variance_explained * 100  # Convert to percentage
)

# Bar plot of % variance explained
ggplot(var_df, aes(x = PC, y = Variance)) +
  geom_bar(stat = "identity", fill = "steelblue") +
  labs(
    title = "Variance Explained by Principal Components",
    x = "Principal Component",
    y = "% of Variance"
  ) +
  theme_minimal()

```



```{r}
ggplot(pca_df, aes(x = PC1, y = PC2, color = Group)) +
  geom_point(size = 4) +
  theme_minimal()

```

```{r}
library(tidyverse)

# Step 1: Filter only Chromosome 12 genes
chr12_genes <- rna %>%
  filter(chromosome_name == "12")

# Step 2: Define thresholds
log2fc_cutoff <- log2(1.5)
padj_cutoff <- 0.05

# Step 3: Categorize genes
chr12_genes <- chr12_genes %>%
  mutate(Regulation = case_when(
    log2FoldChange >= log2fc_cutoff & pAdj < padj_cutoff ~ "Upregulated",
    log2FoldChange <= -log2fc_cutoff & pAdj < padj_cutoff ~ "Downregulated",
    TRUE ~ "Not Significant"
  ))

# Step 4: Volcano plot
ggplot(chr12_genes, aes(x = log2FoldChange, y = -log10(pAdj), color = Regulation)) +
  geom_point(alpha = 0.8, size = 2) +
  scale_color_manual(values = c("Upregulated" = "magenta", "Downregulated" = "blue", "Not Significant" = "gray")) +
  geom_vline(xintercept = c(-log2fc_cutoff, log2fc_cutoff), linetype = "dashed", color = "black") +
  geom_hline(yintercept = -log10(padj_cutoff), linetype = "dashed", color = "black") +
  labs(
    title = "Volcano Plot of Chromosome 12 Genes",
    subtitle = "Trisomic vs. Disomic iPSCs",
    x = "Log2 Fold Change",
    y = "-Log10 Adjusted p-value"
  ) +
  theme_minimal()

```

```{r}

library(tidyverse)
library(ggrepel)  # for better label positioning

# Step 1: Filter only Chromosome 12 genes
chr12_genes <- rna %>%
  filter(chromosome_name == "12")

# Step 2: Define thresholds
log2fc_cutoff <- log2(1.5)
padj_cutoff <- 0.05

# Step 3: Categorize genes
chr12_genes <- chr12_genes %>%
  mutate(Regulation = case_when(
    log2FoldChange >= log2fc_cutoff & pAdj < padj_cutoff ~ "Upregulated",
    log2FoldChange <= -log2fc_cutoff & pAdj < padj_cutoff ~ "Downregulated",
    TRUE ~ "Not Significant"
  ))

# Step 4: Select top 20 up and 20 downregulated genes to label
top_genes <- chr12_genes %>%
  filter(Regulation == "Upregulated") %>%
  arrange(pAdj, desc(log2FoldChange)) %>%
  slice_head(n = 20) %>%
  bind_rows(
    chr12_genes %>%
      filter(Regulation == "Downregulated") %>%
      arrange(pAdj, log2FoldChange) %>%
      slice_head(n = 20)
  )

# Step 5: Volcano plot with triangles instead of circles
ggplot(chr12_genes, aes(x = log2FoldChange, y = -log10(pAdj), color = Regulation)) +
  geom_point(alpha = 0.8, size = 2, shape = 17) +  # triangle shape
  geom_text_repel(
    data = top_genes,
    aes(label = gene_symbol),
    size = 3,
    box.padding = 0.5,
    point.padding = 0.3,
    max.overlaps = Inf,
    segment.color = "gray40"
  ) +
  scale_color_manual(
    values = c(
      "Upregulated" = "red",
      "Downregulated" = "blue",
      "Not Significant" = "gray"
    )
  ) +
  geom_vline(xintercept = c(-log2fc_cutoff, log2fc_cutoff), linetype = "dashed", color = "black") +
  geom_hline(yintercept = -log10(padj_cutoff), linetype = "dashed", color = "black") +
  labs(
    title = "Volcano Plot of Chromosome 12 Genes",
    subtitle = "Trisomic vs. Disomic iPSCs",
    x = "Log2 Fold Change",
    y = "-Log10 Adjusted p-value"
  ) +
  theme_minimal()


```


